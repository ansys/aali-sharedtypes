
name: Auto-generate gRPC files
on:
  push:
    branches:
      - main

jobs:

    protoc:
        name: Create gRPC autogenerated files and commit
        if: github.event.pull_request.merged == true
        runs-on: ubuntu-latest

        steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Install Protoc
          uses: arduino/setup-protoc@v3

        - name: Navigate to root folder and run Protoc
          run: |
            cd $GITHUB_WORKSPACE
            protoc --go_out=pkg --go-grpc_out=pkg pkg/protos/allie-flowkit.proto

        - name: Commit and push
          run: |
            cd $GITHUB_WORKSPACE
            git config --global user.email '${{ github.actor }}@users.noreply.github.com'
            git config --global user.name '${{ github.actor }}'
            git commit -a -m 'Auto-generate gRPC files'
            git push origin main
